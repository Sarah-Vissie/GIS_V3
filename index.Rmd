---
title: "GIS_V3"
output: 
  html_document:
    self_contained: true
date: "2024-02-29"
---


***Determining the location of Aulax species that have not been burnt in the last 14 years***

Firstly, I will load the required packages and libraries. For this I used the pacman package.

```{r}


pacman::p_load(sf, tidyverse, terra, raster, mapview, sp, leaflet)

knitr::opts_chunk$set(echo = TRUE)
```

The locality data of the species that I used was from Protea Atlas Project, this contains data for all Proteacea. I loaded the data using read.csv

```{r}
pa <- read.csv("Data/occ_sub.csv")

```

I then turned the .csv into a simple feature object and from a data frame (pa). I specified the co-ordinate reference system (CRS) of the data. The co-ordinate reference system (CRS) of the data is WGS 84 (EPSG: 4326). The checks are done bellow.

```{r}
pa_sf <- st_as_sf(pa, coords = c("coords.x1", "coords.x2"), crs = 4326)
```

Then I specifically asked it to plot the "geometry" coloumn.

```{r}
pa_sf
plot(pa_sf$geometry)
```

Check the co-ordinate reference system (CRS) of the data

```{r}
st_crs(pa_sf)
```

Read in only data points for *Aulax* species. This can be done using the "AU" Genus_code, each Genus has a unique code.

```{r}
aulax_sf <- pa_sf[pa_sf$Genus_code == "AU",]
plot(aulax_sf$geometry)
```

I then read in the fire data that was obtained from SANBI. This specific data set contains polygons showing fire locations across the Western Cape. The date range is roughly from 1994 to 2021. This should be noted that there would have been more recent fires between 2021 and present.

```{r}
fire <- st_read("All_Fires_20_21_gw/All_Fires_20_21_gw.shp")
```

I then plotted the fire data to visualize the data and then also checked the co-ordinate reference system (CRS) of the data.

```{r}
plot(fire$geometry)
```

```{r}
st_crs(fire)
```

Both are using the same co-ordinate reference system (CRS) which is WGS 84 (EPSG: 4326). So should align correctly.

I filtered out the older dates as I only want to know the location of fires in the last 15 years. Therefore I can determine the location of +- 14 year old *Aulax sp*.

```{r}
fire_2010_2021 <- filter(fire, between(YEAR, 2010, 2021))
```

I then got the following error: **Error in wk_handle.wk_wkb(wkb, s2_geography_writer(oriented = oriented, : \# Loop 0 is not valid: Edge 174 has duplicate vertex with edge 177 sf_use_s2(F)**

With help from Mike Cramer the following code was run to fix it:

```{r}
sf_use_s2(F) # diable s2 geometry
```

Visualize the *Aulax* species with the signifying feature "X"

```{r}
summary(aulax_sf$X)
```

Join *Aulax* with fire

```{r}
aulax_fires_sf <- aulax_sf[fire_2010_2021,]
```

I then got the above message warning that the CRS of the data is not the same. The two data sets both use the same co-ordinate reference system (CRS) which is WGS 84 (EPSG: 4326). So should align correctly.

Visualize the *Aulax* species with the fire data

```{r}
summary(aulax_fires_sf$X)
```

Then I sorted the data to show the *Aulax* species that were NOT found in the fire polygons

```{r}
aulax_no_fires_sf <- aulax_sf[!aulax_sf$X %in% aulax_fires_sf$X, ]
```

I then plotted all *Aulax* (aulax_sf) *Aulax* with fires (aulax_fires_sf) and *Aulax* without fires (aulax_no_fires_sf). This was done to visualize the data.

```{r}
plot(aulax_sf$geometry)
```

```{r}
plot(aulax_fires_sf$geometry)
```

```{r}
plot(aulax_no_fires_sf$geometry)
```

Plot Aulax with no fires and the fire data using ggplot

```{r}
ggplot() + 
  geom_sf(data = aulax_no_fires_sf)

ggplot() +
  geom_sf(data = fire_2010_2021)
```

To visualize both I then used mapview.

```{r}
mapview(aulax_no_fires_sf)
mapview(fire_2010_2021)

mapview(aulax_no_fires_sf) + mapview(fire_2010_2021, col.regions = "red")
```

I wanted the background to be a setelite image so I used leaflet to visualize the data.

```{r}
leaflet() %>% addProviderTiles("Esri.WorldImagery") %>% addMarkers(data = aulax_no_fires_sf, popup = ~Genus_code) %>% addPolygons(data = fire_2010_2021, color = "red")
```

This is now complete. I can now determine the location of *Aulax* species that haven't been burnt in the last 15 years. Although there are some limitations as the fire data does not include Cape Point or certain fires that were on private land. It also does not include fires between 2021 and present. Therefore it is best to be contact with the approprate land owner before venturing out for data collection. I have added Leucadendron species but did not include it in this assignment.



